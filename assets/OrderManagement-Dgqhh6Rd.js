import{a as L,d as R,u as k,o as S,b as w,e as r,f as i,g as e,m as b,t as o,F as v,n as M,r as _,q as x,p as D}from"./index-HlsQhara.js";import{M as z,_ as P}from"./DeleteModal.vue_vue_type_script_setup_true_lang-B32OGWHH.js";const A="https://ec-course-api.hexschool.io",T="emma9898",f=L.create({baseURL:A});f.interceptors.request.use(s=>{const u=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return u&&(s.headers.Authorization=u),s},s=>Promise.reject(s));f.interceptors.response.use(s=>Promise.resolve(s),s=>Promise.reject(s.response.data));const O=s=>f.get(`/v2/api/${T}/admin/orders`,{params:s}),W=s=>f.delete(`/v2/api/${T}/admin/order/${s}`),B={class:"modal-dialog modal-dialog-centered modal-lg"},N={class:"modal-content rounded-lg"},E={class:"modal-body"},U={class:"table table-bordered"},V={class:"h5 text-end"},q={class:"text-danger"},F=R({__name:"OrderDetailModal",props:{order:{}},setup(s,{expose:u}){const a=s,c=k("modalRef");let n=null;return S(()=>{c.value&&(n=new z(c.value))}),w(()=>{n&&n.dispose()}),u({openModal:()=>{n?.show()},closeModal:()=>{n?.hide()}}),(y,t)=>(i(),r("div",{ref_key:"modalRef",ref:c,class:"modal fade",id:"orderDetailModal",tabindex:"-1","aria-labelledby":"orderDetailModalLabel","aria-hidden":"true"},[e("div",B,[e("div",N,[t[11]||(t[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"orderDetailModalLabel"},"訂單詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",E,[e("p",null,[t[0]||(t[0]=e("strong",null,"訂單編號：",-1)),b(" "+o(a.order.id),1)]),e("p",null,[t[1]||(t[1]=e("strong",null,"日期：",-1)),b(" "+o(new Date(a.order.create_at*1e3).toLocaleDateString("zh-TW")),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"客戶名稱：",-1)),b(" "+o(a.order.user.name),1)]),e("p",null,[t[3]||(t[3]=e("strong",null,"地址：",-1)),b(" "+o(a.order.user.address),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"Email：",-1)),b(" "+o(a.order.user.email),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"聯絡電話：",-1)),b(" "+o(a.order.user.tel),1)]),t[8]||(t[8]=e("hr",null,null,-1)),t[9]||(t[9]=e("h6",null,"訂購商品",-1)),e("table",U,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",null,"商品名稱"),e("th",null,"數量"),e("th",null,"小計")])],-1)),e("tbody",null,[(i(!0),r(v,null,M(a.order.products,p=>(i(),r("tr",{key:p.id},[e("td",null,o(p.product.title),1),e("td",null,o(p.qty),1),e("td",null," NT$"+o(p.total.toLocaleString("zh-TW")),1)]))),128))])]),t[10]||(t[10]=e("hr",null,null,-1)),e("p",V,[t[7]||(t[7]=e("strong",null,"總金額：",-1)),e("span",q," NT$"+o(a.order.total.toLocaleString("zh-TW")),1)])]),t[12]||(t[12]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 關閉 ")],-1))])])],512))}}),j={class:"card shadow-sm rounded-lg flex-grow-1"},G={class:"card-body p-4"},H={class:"table-responsive"},I={class:"table table-hover align-middle"},J={class:"order-number"},K={class:"text-nowrap"},Q=["onClick"],X=["onClick"],Y={class:"d-flex justify-content-center mt-4"},Z={class:"pagination"},ee={class:"page-item"},te=["disabled"],le=["onClick","disabled"],oe={class:"page-item"},se=["disabled"],de=R({__name:"OrderManagement",setup(s){const u=k("orderDetailModalRef"),a=k("deleteModalRef"),c=_({create_at:0,id:"",is_paid:!1,total:0,message:"",products:{},user:{address:"",email:"",name:"",tel:""},num:0}),n=_("1"),h=_([]),g=_({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),y=async()=>{try{const d=await O({page:n.value});h.value=d.data.orders,g.value=d.data.pagination}catch{alert("取得訂單列表失敗")}};S(()=>{y()});const t=d=>{c.value=d,u.value?.openModal()},p=d=>{a.value?.openModal(()=>C(d))},C=async d=>{try{await W(d)}catch{alert("刪除訂單失敗")}finally{y()}};return(d,m)=>(i(),r(v,null,[e("div",j,[e("div",G,[e("div",H,[e("table",I,[m[2]||(m[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"日期"),e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"品項"),e("th",{scope:"col"},"金額"),e("th",{scope:"col"},"訂單狀態"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(i(!0),r(v,null,M(h.value,l=>(i(),r("tr",{key:l.id},[e("td",null,o(new Date(l.create_at*1e3).toLocaleDateString("zh-TW")),1),e("td",J,o(l.id),1),e("td",null,o(Object.keys(l.products).length),1),e("td",null," NT$"+o(l.total.toLocaleString("zh-TW")),1),e("td",null,[e("span",{class:D(["badge",{"bg-success":l.is_paid,"bg-danger":!l.is_paid}])},o(l.is_paid?"已付款":"未付款"),3)]),e("td",K,[e("button",{onClick:$=>t(l),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 查看 ",8,Q),e("button",{onClick:$=>p(l.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,X)])]))),128))])])]),e("nav",Y,[e("ul",Z,[e("li",ee,[e("button",{onClick:m[0]||(m[0]=l=>n.value=String(Number(n.value)-1)),disabled:!g.value.has_pre,type:"button",class:"page-link"}," « ",8,te)]),(i(!0),r(v,null,M(g.value.total_pages,l=>(i(),r("li",{key:l,class:"page-item"},[e("button",{onClick:$=>n.value=l.toString(),disabled:n.value===l.toString(),class:D(["page-link",{active:n.value===l.toString()}]),type:"button"},o(l),11,le)]))),128)),e("li",oe,[e("button",{onClick:m[1]||(m[1]=l=>n.value=String(Number(n.value)+1)),disabled:!g.value.has_next,type:"button",class:"page-link"}," » ",8,se)])])])])]),x(F,{ref_key:"orderDetailModalRef",ref:u,order:c.value},null,8,["order"]),x(P,{ref_key:"deleteModalRef",ref:a,title:"刪除訂單",content:"確定要刪除該訂單嗎？"},null,512)],64))}});export{de as default};
