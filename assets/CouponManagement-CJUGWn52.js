import{a as B,d as S,r as _,w as T,u as w,o as U,b as E,e as v,f as b,g as e,t as f,i as k,v as x,h as V,j as P,q as R,m as A,F as M,n as L,p as N}from"./index-HlsQhara.js";import{M as F,_ as I}from"./DeleteModal.vue_vue_type_script_setup_true_lang-B32OGWHH.js";const z="https://ec-course-api.hexschool.io",$="emma9898",h=B.create({baseURL:z});h.interceptors.request.use(l=>{const a=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return a&&(l.headers.Authorization=a),l},l=>Promise.reject(l));h.interceptors.response.use(l=>Promise.resolve(l),l=>Promise.reject(l.response?.data??l));const q=l=>h.get(`/v2/api/${$}/admin/coupons`,{params:l}),G=l=>h.post(`/v2/api/${$}/admin/coupon`,{data:l}),H=l=>{const{id:a,data:i}=l;return h.put(`/v2/api/${$}/admin/coupon/${a}`,{data:i})},W=l=>h.delete(`/v2/api/${$}/admin/coupon/${l}`),j=l=>{const a=new Date(l*1e3),i=u=>u<10?"0"+u:u,d=a.getFullYear(),n=i(a.getMonth()+1),r=i(a.getDate());return`${d}-${n}-${r}`},Y={class:"modal-dialog modal-dialog-centered modal-lg"},J={class:"modal-content rounded-lg"},K={class:"modal-header"},O={class:"modal-title",id:"couponModalLabel"},Q={class:"modal-body"},X={class:"mb-3"},Z={class:"mb-3"},ee={class:"mb-3"},te={class:"mb-3"},oe=["value"],le={class:"mb-3 d-flex align-items-center"},ne={class:"form-check form-switch"},se={class:"modal-footer"},ae=["disabled"],de=S({__name:"CouponModal",props:{coupon:{},isLoading:{type:Boolean}},setup(l,{expose:a}){const i=l,d=()=>({id:"",title:"",is_enabled:0,percent:0,due_date:Math.floor(Date.now()/1e3),code:""}),n=_(d());T(()=>i.coupon,p=>{p?.id?n.value={...p}:n.value=d()},{immediate:!0,deep:!0});const r=w("modalRef");let c=null,u=null;U(()=>{r.value&&(c=new F(r.value))}),E(()=>{c?.dispose()});const g=p=>{c&&(c.show(),u=async t=>{try{await p(t),m()}catch{}})},m=()=>{c?.hide()},y=()=>{u&&u(n.value)},C=p=>{const t=p.target;n.value.due_date=Math.floor(new Date(t.value).getTime()/1e3)};return a({openModal:g,closeModal:m}),(p,t)=>(b(),v("div",{ref_key:"modalRef",ref:r,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",Y,[e("div",J,[e("div",K,[e("h5",O,f(n.value.id?"編輯優惠券":"新增優惠券"),1),e("button",{type:"button",class:"btn-close",onClick:m})]),e("div",Q,[e("form",null,[e("div",X,[t[4]||(t[4]=e("label",{for:"couponTitle",class:"form-label"},"優惠券標題",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.title=o),type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例如：新會員專屬折扣"},null,512),[[x,n.value.title]])]),e("div",Z,[t[5]||(t[5]=e("label",{for:"couponCode",class:"form-label"},"優惠碼",-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.code=o),type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例如：NEW2024"},null,512),[[x,n.value.code]])]),e("div",ee,[t[6]||(t[6]=e("label",{for:"couponDiscount",class:"form-label"},"折扣",-1)),k(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.percent=o),type:"number",min:"0",max:"100",class:"form-control rounded-lg",id:"couponDiscount",placeholder:"例如：90 代表 9 折"},null,512),[[x,n.value.percent,void 0,{number:!0}]])]),e("div",te,[t[7]||(t[7]=e("label",{for:"couponEndDate",class:"form-label"},"截止日",-1)),e("input",{value:V(j)(n.value.due_date),onChange:C,type:"date",class:"form-control rounded-lg",id:"couponEndDate"},null,40,oe)]),e("div",le,[t[8]||(t[8]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",ne,[k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>n.value.is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[P,n.value.is_enabled]])])])])]),e("div",se,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:m}," 取消 "),e("button",{onClick:y,disabled:i.isLoading,type:"button",class:"btn btn-dark"}," 儲存 ",8,ae)])])])],512))}}),ie={class:"d-flex justify-content-end align-items-center pe-3 mb-4"},ce={key:0,class:"text-center"},re={key:1,class:"card shadow-sm rounded-lg flex-grow-1"},ue={class:"card-body p-4"},pe={class:"table-responsive"},me={class:"table table-hover align-middle"},ve={class:"text-center"},be={class:"form-check form-switch d-flex justify-content-center"},_e=["checked"],fe={class:"text-nowrap"},he=["onClick"],ge=["onClick"],ye={class:"d-flex justify-content-center mt-4"},ke={class:"pagination"},$e={class:"page-item"},Ce=["disabled"],xe=["onClick"],Me={class:"page-item"},we=["disabled"],Le=S({__name:"CouponManagement",setup(l){const a=()=>({id:"",title:"",is_enabled:0,percent:0,due_date:Math.floor(Date.now()/1e3),code:""}),i=_(a()),d=_("1"),n=_([]),r=_({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),c=async()=>{try{const t=await q({page:d.value});n.value=t.data.coupons,r.value=t.data.pagination}catch{alert("取得優惠券列表失敗")}};U(c),T(d,c);const u=w("couponModalRef"),g=w("deleteModalRef"),m=_(!1),y=t=>{t?i.value={...t}:i.value=a(),u.value?.openModal(async o=>{m.value=!0;try{o.id?await H({id:o.id,data:{...o,is_enabled:Number(o.is_enabled)}}):await G({...o,is_enabled:Number(o.is_enabled)})}catch{alert("新增 / 編輯優惠券失敗")}finally{m.value=!1,c()}})},C=t=>{g.value?.openModal(()=>p(t))},p=async t=>{try{await W(t)}catch{alert("刪除優惠券失敗")}finally{c()}};return(t,o)=>(b(),v(M,null,[e("div",ie,[e("button",{onClick:o[0]||(o[0]=s=>y()),class:"btn btn-dark rounded-lg px-4 py-2",type:"button"},[...o[3]||(o[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),A("新增優惠券 ",-1)])])]),n.value.length===0?(b(),v("p",ce,"目前還沒有優惠券")):(b(),v("div",re,[e("div",ue,[e("div",pe,[e("table",me,[o[4]||(o[4]=e("thead",null,[e("tr",null,[e("th",null,"優惠券標題"),e("th",null,"優惠碼"),e("th",null,"折扣"),e("th",null,"截止日"),e("th",{class:"text-center"},"啟用"),e("th")])],-1)),e("tbody",null,[(b(!0),v(M,null,L(n.value,s=>(b(),v("tr",{key:s.id},[e("td",null,f(s.title),1),e("td",null,f(s.code),1),e("td",null,f(s.percent)+"%",1),e("td",null,f(V(j)(s.due_date)),1),e("td",ve,[e("div",be,[e("input",{class:"form-check-input",type:"checkbox",readonly:"",style:{"pointer-events":"none"},checked:!!s.is_enabled},null,8,_e)])]),e("td",fe,[e("button",{onClick:D=>y(s),class:"btn btn-sm btn-outline-dark me-2"}," 編輯 ",8,he),e("button",{onClick:D=>C(s.id),class:"btn btn-sm btn-outline-danger"}," 刪除 ",8,ge)])]))),128))])])]),e("nav",ye,[e("ul",ke,[e("li",$e,[e("button",{class:"page-link",disabled:!r.value.has_pre,onClick:o[1]||(o[1]=s=>d.value=String(Number(d.value)-1))}," « ",8,Ce)]),(b(!0),v(M,null,L(r.value.total_pages,s=>(b(),v("li",{key:s,class:"page-item"},[e("button",{class:N(["page-link",{active:d.value===s.toString()}]),onClick:D=>d.value=s.toString()},f(s),11,xe)]))),128)),e("li",Me,[e("button",{class:"page-link",disabled:!r.value.has_next,onClick:o[2]||(o[2]=s=>d.value=String(Number(d.value)+1))}," » ",8,we)])])])])])),R(de,{ref_key:"couponModalRef",ref:u,coupon:i.value,"is-loading":m.value},null,8,["coupon","is-loading"]),R(I,{ref_key:"deleteModalRef",ref:g,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{Le as default};
